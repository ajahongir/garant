<script type="text/javascript" src="/javascripts/jcarousel/lib/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="/javascripts/jcarousel/lib/jquery.jcarousel.min.js"></script>
<link rel="stylesheet" type="text/css" href="/javascripts/jcarousel/skins/tango/small.css"/>

<script type="text/javascript" src="_http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<link rel="stylesheet" type="text/css" href="/javascripts/jquery-ui-1.7.3.custom/development-bundle/themes/ui-lightness/ui.all.css"/>
<script type="text/javascript" src="/javascripts/jquery-ui-1.7.3.custom/development-bundle/ui/ui.core.js"></script>
<script type="text/javascript" src="/javascripts/jquery-ui-1.7.3.custom/development-bundle/ui/ui.progressbar.js"></script>

<meta charset="utf-8">
<style>
  #demo-frame > div.demo { padding: 10px !important; };
</style>
<script>
  $(function() {
		$( "#progressbar" ).progressbar({
			value: <%= @percent %>
		});
	});
</script>

<div class="target">
  <table>
    <tr>
      <td style="width: 350px;">
        <img width="350px" src='/system/images/<%= @target.photo %>' alt="<%= @target.name %>">
      </td>
      <td valign="top">
        <h1>
          <%= @target.name %>
        </h1>
        <p>
          <%= raw @target.description %>
        </p>
      </td>
    </tr>
  </table>
  <div style="height: 200px; margin: 0px 50px;" id="map_canvas"></div>
  <br/>
  <div class="progress">
    <table>
      <tr>
        <td style="text-align: left; width: 200px;">
          <h1 class="caption">Стадия строительства</h1>
        </td>
        <td style="width: 450px;" >
          <div id="progressbar">
            <div id="progresstext"><p><%= @percent %>%</p></div>
            <div id="progressEvent">
              <% @target.events.each do |event| %>
                <div class="progress_event" style="width: <%= @event_percent %>%">
                  <div class="news_tool_shadow">
                    <div class="news_tool" style="padding: 80px 40px 420px 30px;">
                      <div>
                        <% EventImage.find(:all, :conditions => {:event_id => event.id}, :limit => 2, :order => "created_at desc").each do |event_image| %>
                          <img src="/system/images/<%= event_image.image.image_uid %>" width="135px;" height="120px;">
                        <% end %>
                      </div>
                      <div style="width: 300px;">
                        <h1 class="caption"><%= event.name %></h1>
                        <p><%= event.created_at.strftime("%d.%m.%Y") %></p>
                        <p>
                          <%= raw event.description %>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
              <div class="left"><p style="font-size: 14px; font-weight: bold; margin-top: 20px; color: #5C5D5F;"><%= raw(@months[Time.now.month] +"</br>"+ Time.now.strftime("%Y")) %></p></div>
            </div>
            <div class="left"><p style="margin-top: 20px; color: #5C5D5F;"><%= raw(@months[@target.date_start.month] +"</br>"+ @target.date_start.strftime("%Y")) %></p></div>

            <div class="right"><p style="margin-top: 20px; color: #5C5D5F;"><%= raw (@months[@target.date_end.month] +"</br>"+ @target.date_end.strftime("%Y")) %></p></div>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <% content_for :body_content_title do %>
    <%= @target.name %>
  <% end %>


  <% content_for :body_content_left do %>
    <% @target.recent_events.each do |event| %>
      <hr/>
      <section>
        <h1><%= event.name %></h1>
        <p><%= event.created_at.strftime("%d.%m.%Y") %></p>
        <p>
          <%= raw event.description %>
        </p>
      </section>
    <% end %>
  <% end %>

  <% content_for :body_content_right do %>
    <aside>
        <div style="heigth: 200px;">
          <div>
            <ul id="mycarousel" class="jcarousel-skin-tango" style="heigth: 200px;">
              <% @target.events.each do |event| %>
                <% event.images.each do |image| %>
                  <li>
                    <img src="/system/images/<%= image.image_uid %>" width="167px;" height="162px;" alt="" />
                    <a href="#"><%= event.name %></a>
                  </li>
                <% end %>
              <% end %>
              <li>
                <img src="/images/building1.png" width="167px;" height="162px;" alt="" />
                <a href="#">г.Севастополь, ул. Ерошенко 9</a>
              </li>
              <li>
                <img src="/images/building2.png" width="167px;" height="162px;" alt="" />
                <a href="#">г.Севастополь, ул. Ерошенко 9</a>
              </li>
              <li>
                <img src="/images/building3.png" width="167px;" height="162px;" alt="" />
                <a href="#">г. Севастополь, ул. Льва Толстого, 16</a>
              </li>
              <li>
                <img src="/images/building1.png" width="167px;" height="162px;" alt="" />
                <a href="#">г.Севастополь, ул. Ерошенко 9</a>
              </li>
              <li>
                <img src="/images/building3.png" width="167px;" height="162px;" alt="" />
                <a href="#">г.Севастополь, ул. Ерошенко 9</a>
              </li>
              <li>
                <img src="/images/building2.png" width="167px;" height="162px;" alt="" />
                <a href="#">г. Севастополь, ул. Льва Толстого, 16</a>
              </li>
            </ul>
          </div>
        </div>
    </aside>
  <% end %>
  <%= render :partial => "/shared/content_page" %>
  <hr/>
  <section>
    <table>
      <tr>
        <td style="text-align: left; padding-left: 35px;" valign="top">
          <h1 class="caption">Планировки</h1>
          <ul id="floors">
            <% @target.target_floors.each do |f| %>
              <li id="floor_<%= f.floor %>" onclick="active_floor('floor_<%= f.floor %>', <%= f.floor %>); return false;">
                <h1 class="caption"><%= link_to f.floor, "#" %></h1>
              </li>
            <% end %>
            <div></div>
          </ul>
        </td>
        <td>
          <image id="floor_image" src="" style="width: 600px; height: 500px;">
        </td>
      </tr>
    </table>
  </section>
</div>
<script type="text/javascript">
  var floor_images = { <%= @target.target_floors.map{|f| f.floor.to_s+":'/system/images/"+Image.find(f.image_id).image_uid+"'"}.join(", ") %> };
  function active_floor(id, floor)
  {
    console.debug(id, floor_images[floor-1]);
    jQuery('#floors li').attr("class", "");
    jQuery('#floors #' + id).attr("class", "active");
    jQuery('#floor_image').attr("src", floor_images[floor]);
  }
  <% unless @target.target_floors.blank? -%>
    active_floor("floor_<%= @target.target_floors.first.floor %>" , <%= @target.target_floors.first.floor %>);
  <% end -%>
</script>

<script type="text/javascript">
  function initialize() {
    var latlng = new google.maps.LatLng(-34.397, 150.644);
    var myOptions = {
      zoom: 8,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
  }
window.onload = function(){
 // initialize();
}
</script>

<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery('#mycarousel').jcarousel({
      auto: 2,
      wrap: 'circular',
      animation: 10000
    });
  });

  this.tooltip = function(){
	  /* CONFIG */
		  xOffset = -10;
		  yOffset = 3;
	  /* END CONFIG */
	  $(".progress_event").hover(function(e){
		  $(".news_tool_shadow", e.target)
			  .css("top",(e.pageY - xOffset) + "px")
			  .css("left",(e.pageX + yOffset) + "px")
			  .fadeIn("fast");
      },
	  function(){console.log("fadeOut");
		  $(".news_tool_shadow").fadeOut("fast");
    });
	  $(".progress_event").mousemove(function(e){
	  	$(".news_tool_shadow")
	  		.css("top",(e.pageY - xOffset) + "px")
	  		.css("left",(e.pageX + yOffset) + "px");
	  });
  };
  // starting the script on page load
  $(document).ready(function(){
	  tooltip();
    $(".news_tool_shadow").hide();
  });
</script>

